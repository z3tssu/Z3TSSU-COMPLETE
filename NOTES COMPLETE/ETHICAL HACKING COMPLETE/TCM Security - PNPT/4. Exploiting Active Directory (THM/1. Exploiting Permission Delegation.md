---
title: 1. Exploiting Permission Delegation
updated: 2023-04-24T17:08:03.0000000+04:00
created: 2023-04-23T18:48:43.0000000+04:00
---

1\. Exploiting Permission Delegation
Sunday, April 23, 2023
6:48 PM
Active Directory can delegate permissions and privileges through a feature called Permission Delegation (not to be confused with Kerberos Delegation that will be discussed in the next task).

## Delegation is what makes AD so powerful in organisations. 

### Example: 

- Imagine we work for an organisation that has 50000 employees.
- Since we care about security, we only have three users that have access to DA credentials.
- It would be impossible for those three users to field all requests from the users, such as resetting their passwords.
- Using Delegation, we can delegate the permission to force change a user's password to the Helpdesk team, meaning they now have a delegated privilege for this specific function.
- In principle, to keep Delegation secure, the principle of least privilege should be followed.
- However, in large organisations, this is easier said than done.

In this task we will look at exploiting some Delegation misconfigurations.

## Permission Delegation

1.  Permission Delegation exploits are often referred to as ACL-based attacks.
2.  AD allows administrators to configure Access Control Entries (ACEs) that populates Discretionary Access Control Lists (DACLs), hence the name ACL-based attacks.
3.  Almost any AD object can be secured with ACEs, which then describe the allowed and denied permissions that any other AD object has against the target object.
4.  However, if these ACEs are misconfigured, it may be possible for an attacker to exploit them.

### Let's look at our example again. 

If the IT Support team were granted the ForceChangePassword ACE over the Domain Users group, this would be considered insecure. Sure they would be able to reset the passwords of employees that forgot their passwords, but this misconfiguration would allow them to also reset the passwords of privileged accounts, such as the accounts that are members of the Domain Admins group essentially allowing for privilege escalation.

## Exploiting ACEs

A significant amount of ACEs can be misconfigured, and the exploits for each vary. The Bloodhound documentation assists in explaining enumerated ACEs and how they can be exploited. However, we will look at a couple of notable ones here:

ForceChangePassword:

- We have the ability to set the user's current password without knowing their current password.

AddMembers:

- We have the ability to add users (including our own account), groups or computers to the target group.

GenericAll:

- We have complete control over the object, including the ability to change the user's password, register an SPN or add an AD object to the target group.

GenericWrite:

- We can update any non-protected parameters of our target object. This could allow us to, for example, update the scriptPath parameter, which would cause a script to execute the next time the user logs on.

WriteOwner:

- We have the ability to update the owner of the target object. We could make ourselves the owner, allowing us to gain additional permissions over the object.

WriteDACL:

We have the ability to write new ACEs to the target object's DACL. We could, for example, write an ACE that grants our account full control over the target object.

AllExtendedRights:

- We have the ability to perform any action associated with extended AD rights against the target object. This includes, for example, the ability to force change a user's password.

In order to exploit these ACEs, we will need a method to interact with AD to make these requests. The two best options for this are the AD-RSAT PowerShell cmdlets or PowerSploit. Depending on the breach and the detection tools in the environment, one option may be stealthier. In this task we will show both.

