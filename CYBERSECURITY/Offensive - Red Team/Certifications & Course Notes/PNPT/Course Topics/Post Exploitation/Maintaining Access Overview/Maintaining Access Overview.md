### **Notes: Maintaining Access**

---

### **Definition:**

- Maintaining access ensures the attacker can regain access to a machine, even if connectivity is lost (e.g., user shuts down the system).

---

![[/image 71.png|image 71.png]]

### **Key Considerations**:

1. **When Losing Access**:
    - Users shutting down systems can result in losing a shell.
    - Solutions:
        - Ensure a mechanism is in place to re-establish a connection after reboot or reconnection to the network.
        - Advanced solutions include **command-and-control** frameworks.
2. **Common Techniques**:
    - **Adding a User**:
        - Add a persistent user account for re-entry.
        - Reuse tools like `PsExec` to access the machine:
            
            ```Shell
            net user <username> <password> /add
            net localgroup administrators <username> /add
            ```
            
    - **Using Persistent Scripts**:
        - Example: Run a script to open a port with no authentication.
            - **Risks**: No security; open ports are easily exploited.
            - **Applicability**: Rarely justified in penetration testing due to danger.
3. **Alternative Persistence Techniques**:
    - **Scheduled Tasks**:
        - Use scheduled malware tasks for periodic check-ins (e.g., every 5 minutes).
        - Regains shell after reboots or interruptions.
    - **Red Team Techniques**:
        - In-depth, quieter methods focus on stealth and long-term persistence.
        - Not generally relevant for typical penetration testing engagements.

---

### **Practical Guidance**:

1. **For Penetration Tests**:
    - Most scenarios allow louder actions (e.g., adding a user).
    - Clients often fail to detect basic persistence actions (e.g., user creation).
2. **Red Team vs. Penetration Testing**:
    - Red team:
        - Requires stealth, advanced techniques, and minimal footprint.
    - Penetration Testing:
        - Prioritizes task efficiency; loud techniques are acceptable.

---