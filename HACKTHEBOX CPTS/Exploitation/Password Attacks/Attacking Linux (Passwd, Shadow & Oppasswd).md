

## PAM (Pluggable Authentication Modules)

- PAM controls authentication & password policies.
    
- Key module: **pam_unix.so** (or pam_unix2.so).
    
- Location:
    
    ```
    /usr/lib/x86_64-linux-gnu/security/
    ```
    

---

## /etc/passwd

- World-readable file containing user metadata.
    
- **Format:**
    
    ```
    username : password : UID : GID : comment : home_directory : shell
    ```
    
- Example:
    
    ```
    cry0l1t3:x:1000:1000:cry0l1t3,,,:/home/cry0l1t3:/bin/bash
    ```
    
- **Security notes:**
    
    - `x` → password stored in `/etc/shadow`.
        
    - `*` or `!` → locked account.
        
    - Blank password field → no password required (root login risk).
        

**Privilege Escalation Example:**  
Before:

```
root:x:0:0:root:/root:/bin/bash
```

After:

```
root::0:0:root:/root:/bin/bash
```

Now `su` grants direct root access.

---

## /etc/shadow

- Root-only file containing encrypted password hashes.
    
- **Format:**
    
    ```
    username : hash : last_change : min_age : max_age : warn : inactive : expire : unused
    ```
    
- Example:
    
    ```
    kali:$y$j9T$ufXTBpN1QpgwlgqRFmb/B0$/.y0ybAF4iNQXniErsDWf9QSl2HZH7LnBeRHB4ZiQa9:20057:0:99999:7:::
    ```
    

### Hash Prefix → Algorithm

- `$1$` → MD5
    
- `$2a$` → Blowfish
    
- `$2y$` → Eksblowfish
    
- `$5$` → SHA-256
    
- `$6$` → SHA-512 (default modern distros)
    

---

## /etc/security/opasswd

- Stores **old password hashes** (prevents reuse).
    
- Example entry:
    
    ```
    cry0l1t3:1000:2:$1$HjFAfYTG$qNDkF0zJ3v8ylCOrKB0kt0,$1$kcUjWZJX$E9uMSmiQeRh4pAAgzuvkq1
    ```
    
- May contain **weak legacy hashes** (MD5).
    

---

## Cracking Linux Hashes

### Step 1 – Unshadowing

```
sudo cp /etc/passwd /tmp/passwd.bak
sudo cp /etc/shadow /tmp/shadow.bak
unshadow /tmp/passwd.bak /tmp/shadow.bak > /tmp/unshadowed.hashes
```

### Step 2 – Crack with Hashcat

**SHA-512 (mode 1800):**

```
hashcat -m 1800 -a 0 /tmp/unshadowed.hashes rockyou.txt -o /tmp/unshadowed.cracked
```

**MD5 (mode 500):**

```
hashcat -m 500 -a 0 md5-hashes.list rockyou.txt
```

---

## Summary

- **/etc/passwd** → user info (world-readable).
    
- **/etc/shadow** → encrypted password hashes (root-only).
    
- **/etc/security/opasswd** → old passwords (reuse prevention).
    

### Key Risks

- Misconfigured permissions (writable passwd/shadow).
    
- Weak/legacy hashes (MD5).
    
- Password reuse across systems.
    

### Tools

- `unshadow`
    
- `hashcat`
    
- Wordlists (e.g., `rockyou.txt`)
    

---

Do you want me to also create a **side-by-side cheatsheet** showing hash types (`MD5, SHA-512, Blowfish`) with their **Hashcat modes** for faster cracking reference?