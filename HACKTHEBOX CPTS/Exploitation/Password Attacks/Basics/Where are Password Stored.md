

## General Concept

- **Authentication mechanisms** compare user-supplied credentials with stored credentials (local or remote).
    
- **Local storage:** Credentials stored directly on the system.
    
- **Web apps:** Vulnerable to **SQL Injection**; attackers can extract credentials.
    
    - Example: **RockYou breach** (32M accounts, plaintext passwords).
        
    - Resulted in the famous `rockyou.txt` (~14M passwords).
        

---

# Linux Credential Storage

## `/etc/shadow`

- Stores **encrypted credentials**.
    
- Example:
    
    ```
    htb-student:$y$j9T$3QSBB6CbHEu...SNIP...f8Ms:18955:0:99999:7:::
    ```
    
- Structure:
    
    ```
    <username>:<encrypted password>:<last change>:<min age>:<max age>:<warning>:<inactivity>:<expiration>:<reserved>
    ```
    
- Hash Format:
    
    ```
    $<id>$<salt>$<hashed_password>
    ```
    
    - `$1$` → MD5
        
    - `$5$` → SHA-256
        
    - `$6$` → SHA-512
        
    - `$y$` → yescrypt (modern default)
        

---

## `/etc/passwd`

- Stores **user account info**, not passwords.
    
- Example:
    
    ```
    htb-student:x:1000:1000:,,,:/home/htb-student:/bin/bash
    ```
    
- Structure:
    
    ```
    <username>:x:<uid>:<gid>:<comment>:<home dir>:<shell>
    ```
    
- `x` → password is stored in `/etc/shadow`.
    
- **Misconfigured `/etc/shadow` permissions** → privilege escalation risk.
    

---

# Windows Credential Storage

## Authentication Process

Key components:

- `WinLogon.exe` – Handles logon process
    
- `LogonUI` – Logon screen
    
- **Credential Providers** – Capture credentials
    
- **LSASS** – Core authentication manager
    
- **Authentication Packages** – e.g., Kerberos, MSV1_0
    
- **SAM** or **Active Directory** – Final credential validation
    

---

## LSASS

- Path:
    
    ```
    %SystemRoot%\System32\lsass.exe
    ```
    
- Functions:
    
    - User authentication
        
    - Security policy enforcement
        
    - Logging security events
        
- **Critical Target:** Stealing LSASS memory reveals creds.
    

---

## SAM Database

- Path:
    
    ```
    %SystemRoot%\System32\config\SAM
    ```
    
    (Mounted as `HKLM\SAM`)
    
- Stores:
    
    - Usernames
        
    - Password hashes (LM or NTLM)
        
- **Access requires SYSTEM privileges**.
    
- Protected by **SYSKEY** since NT 4.0.
    

---

## Domain Authentication

- If joined to a domain, credentials validated against **Active Directory**.
    

**NTDS.dit**

- Path:
    
    ```
    %SystemRoot%\ntds\ntds.dit
    ```
    
- Found on **Domain Controllers**.
    
- Stores:
    
    - User, group, and computer accounts
        
    - Password hashes
        
    - Group policy objects
        

---

## Credential Manager

- Built-in storage for:
    
    - Network shares
        
    - Websites
        
    - Remote resources
        

**Paths:**

```
C:\Users\<Username>\AppData\Local\Microsoft\Vault\
C:\Users\<Username>\AppData\Local\Microsoft\Credentials\
```