# Enumerating and Retrieving Password Policies

## Overview

Enumerating domain password policies is a critical step in both internal and external penetration testing. These policies guide the attacker's strategy, especially in password spraying and brute-force attacks. Policies can be retrieved with or without credentials using various tools and methods on both Linux and Windows platforms.

---

## 1. Enumerating with Credentials (Linux)

### Tools: CrackMapExec

**Command** (Attacker):

```Shell
crackmapexec smb 172.16.5.5 -u avazquez -p Password123 --pass-pol
```

**Note**: Requires valid credentials. Retrieves detailed password policy via SMB.

---

## 2. Enumerating via SMB NULL Sessions (Linux)

### Tools: rpcclient, enum4linux, CrackMapExec

### Using `rpcclient`

**Command** (Attacker):

```Shell
\#Connect to RCP Client
rpcclient -U "" -N 172.16.5.5

\#querydominfo to obtain information about the domain and confirm NULL session access.
rpcclient $> querydominfo

\#obtain the password policy
rpcclient $> getdompwinfo
```

**Output Summary**:

- Minimum Password Length: 8
- Password Complexity: Enabled

### Using `enum4linux`

**Command**:

```Shell
enum4linux -P 172.16.5.5
```

**Output**: Identical policy results to `rpcclient`.

### Using `enum4linux-ng`

**Command**:

```Shell
enum4linux-ng -P 172.16.5.5 -oA ilfreight

\#Displaying the contents of the output
cat ilfreight.json
```

**Output Format**: JSON/YAML. Clear and structured policy results.

**Note**: Works over port 445. Useful for automation and data parsing.

---

## 3. Enumerating via SMB NULL Sessions (Windows)

### Tools: net.exe

**Commands**:

```Plain
net use \\\\DC01\\ipc$ "" /u:""
```

**Use a username/password combination to attempt to connect.**

```Shell
\#use username to connect
net use \\DC01\ipc$ "" /u:guest

\#Use username/password to connect
net use \\DC01\ipc$ "password" /u:guest
```

---

## 4. Enumerating via LDAP Anonymous Bind (Linux)

### Tools: ldapsearch

```Shell
ldapsearch -h 172.16.5.5 -x -b "DC=INLANEFREIGHT,DC=LOCAL" -s sub "*" | grep -m 1 -B 10 pwdHistoryLength
```

**Note**: Anonymous LDAP bind must be permitted by the domain controller.

---

## 5. Enumerating with Credentials (Windows)

### Using `net.exe`

```Plain
net accounts
```

### Using PowerView

```PowerShell
Import-Module .\\PowerView.ps1
Get-DomainPolicy
```

**Output Summary**:  
Same as `net accounts` with additional GPO path and complexity flag.

---

## Summary

The INLANEFREIGHT.LOCAL domain allows various credentialed and anonymous enumeration methods using both SMB and LDAP. Password policy settings reveal opportunities for safe password spraying if done cautiously. Stealth, timing, and adherence to best practices are essential to avoid user account lockouts during assessments.

---