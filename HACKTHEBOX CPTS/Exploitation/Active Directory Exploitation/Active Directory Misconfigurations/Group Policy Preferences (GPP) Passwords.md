
## Summary

- GPP creates XML files in the SYSVOL share (and cached on endpoints) when GPP items are configured (drive maps, local users, printers, services, scheduled tasks, local admin/password changes, autologon registry entries).
    
- Those XML files can contain passwords in the `cpassword` attribute (AES-256 encrypted). Microsoft publicly published the AES key, so `cpassword` values can be trivially decrypted by any authenticated domain user.
    
- By default SYSVOL is readable by all authenticated users, so any domain user can enumerate and retrieve these files.
    
- Microsoft issued MS14-025 (2014) to block setting passwords via GPP going forward, but the patch does **not** remove existing XML files from SYSVOL; cached copies can remain on hosts if a GPO is deleted incorrectly.
    

---

## Why this matters (impact)

- Any domain user can obtain plaintext credentials (service/local/domain) from SYSVOL.
    
- Retrieved credentials are often reused; a decrypted password + internal password spray can lead to further compromise (local admin, domain escalation).
    
- Autologon credentials may be stored in `Registry.xml` in cleartext if pushed by GPO â€” these are readable as well.
    
- Legacy/disabled accounts may appear in XML but still be useful if password reused elsewhere.
    

---

## Where to look (files & locations)

- SYSVOL share on domain controllers:
    
    - `\\<domain>\SYSVOL\<domain>\Policies\{GPO_GUID}\Machine\Preferences\Groups\Groups.xml`
        
    - `.../Preferences/Registry/Registry.xml` (autologon)
        
    - `.../Preferences/Printers/printers.xml`
        
    - `.../Preferences/Drives/drives.xml`
        
    - `.../Preferences/Services/services.xml`
        
    - `.../Preferences/ScheduledTasks/scheduledtasks.xml`
        

---

## Typical XML pattern

- Example (illustrative):
    

```xml
<User name="Administrator" accountDisabled="false" passwordNeverExpires="true" cpassword="VPe/o9YRyz2cksnYRbNeQj35w9KxQ5ttbvtRaAVqxaE" />
```

- `cpassword` is the encrypted value you retrieve and then decrypt.
    

---

## Tools & commands (enumeration & decryption)

#### Decrypting the Password with gpp-decrypt

```
$ gpp-decrypt VPe/o9YRyz2cksnYRbNeQj35w9KxQ5ttbvtRaAVqxaE
# => Password1
```

#### Locating & Retrieving GPP Passwords with CrackMapExec

```bash
z3tssu@htb[/htb]$ crackmapexec smb -L | grep gpp

[*] gpp_autologin             Searches the domain controller for registry.xml to find autologon information and returns the username and password.
[*] gpp_password              Retrieves the plaintext password and other information for accounts pushed through Group Policy Preferences.
```

#### Using CrackMapExec's gpp_autologin Module

```shell-session
crackmapexec smb 172.16.5.5 -u forend -p Klmcargo2 -M gpp_autologin

```

## Pentester checklist (quick)

1. [ ] Identify domain controllers / SYSVOL accessible hosts.
    
2. [ ] Enumerate SYSVOL:
    
    - [ ] Browse `\\<domain>\SYSVOL\` and recursively search `Policies\{*}\Machine\Preferences\*` and `User\Preferences\*`.
        
3. [ ] Search for XML files with password attributes (`cpassword`, `password`, `autologon`).
    
4. [ ] Extract `cpassword` values.
    
5. [ ] Decrypt `cpassword` using `gpp-decrypt` or `Get-GPPPassword.ps1`.
    
6. [ ] Test credentials:
    
    - [ ] Try local login on likely hosts (where account would be local admin).
        
    - [ ] Try domain authentication (NTLM/LDAP) and service access.
        
    - [ ] Try internal password spray across other accounts/hosts (be careful to avoid lockouts and follow rules-of-engagement).
        
7. [ ] If successful, enumerate for privilege escalation paths (ACLs, shares, RDP/SMB).
    
8. [ ] Document discovered GPO GUIDs and exact XML file paths (for reporting).
    
9. [ ] Leave evidence and cleanup only as permitted by engagement rules.
    

---

