# GPO Abuse Cheat Sheet

## Overview
- **What it is**: Group Policy Objects (GPOs) apply advanced settings to users/computers in AD for hardening (e.g., user configs, OS/apps). Abusable via ACL misconfigs for lateral movement, priv esc, domain compromise, or persistence.
- **Why abuse**: Gain rights over GPO (e.g., WriteProperty, WriteDacl) to push malicious changes to linked OUs/hosts/users.
- **Common misconfigs**: Overly permissive rights (e.g., Domain Users group editable on GPO).
- **Impact**: Changes apply to all affected objects; be cautious—can hit many hosts (e.g., don't add local admin to 1,000+ machines accidentally).
- **Enumeration tools**: PowerView, BloodHound, Get-GPO (built-in), group3r, ADRecon, PingCastle.
- **Exploitation tools**: SharpGPOAbuse (for adding users/admins, tasks, scripts); attacks covered in-depth later.

## Potential Abuses
- **Add user rights**: Grant SeDebugPrivilege, SeTakeOwnershipPrivilege, SeImpersonatePrivilege to controlled user for priv esc.
- **Add local admin**: Add controlled user to local admins on targeted hosts.
- **Immediate scheduled task**: Run arbitrary actions (e.g., reverse shell) on affected hosts.
- **Startup script**: Configure malicious computer startup script for persistence/shell.
- **Other**: Target specific users/hosts if option available; avoid mass impact.

## Enumeration
- **List GPO names (PowerView)**: Get display names to spot security policies (e.g., password policies, autologon, AD CS).
  ```
  Get-DomainGPO | select displayname
  ```
- **List GPO names (Built-in Cmdlet)**: Requires Group Policy Management Tools installed.
  ```
  Get-GPO -All | Select DisplayName
  ```
- **Convert GUID to name**: Use with Get-GPO for human-readable info.
  ```
  Get-GPO -Guid <GUID>
  ```
  - Outputs: DisplayName, DomainName, Owner, Id, Status, etc.

## Checking Permissions
- **User/group rights over GPO**: Check if controlled user/group (e.g., Domain Users) has edit rights.
  - Convert name to SID:
    ```
    $sid = Convert-NameToSid "Domain Users"
    ```
  - Get ACLs:
    ```
    Get-DomainGPO | Get-ObjectAcl | ?{$_.SecurityIdentifier -eq $sid}
    ```
  - Look for: WriteProperty, WriteDacl, WriteOwner, GenericWrite—leverage for full control.
- **BloodHound analysis**:
  - Query: Rights from group/user to GPO (e.g., GenericWrite, WriteOwner, WriteDacl).
  - Node Info > Affected Objects: See linked OUs/computers (e.g., GPO applied to OU with 4 hosts).
  - Graph: DOMAIN USERS@DOMAIN -> GenericWrite/WriteOwner/WriteDacl -> GPO@DOMAIN.
  - GpLink: GPO -> OU -> Computers.

## Exploitation
- **Leverage rights**: If editable (e.g., via Domain Users), use for attacks on linked OUs.
- **SharpGPOAbuse**: Abuse misconfig (e.g., add local admin, create task for shell).
  - Options: Target specific host/user to avoid broad impact.
  - Example targets: Not exploitable in demo; focus on controlled changes.
- **Notes**: Test in lab; report misconfigs (e.g., Domain Users editable on GPO) as findings.

## Key Tools
- **Windows**: PowerView (enum/ACLs), Get-GPO (built-in enum), BloodHound (graphs/relations), SharpGPOAbuse (exploit).
- **General**: group3r/ADRecon/PingCastle (GPO security audit).
- **Tips**: Start with broad enum, check perms on interesting GPOs (e.g., autologon for readable passwords), use BloodHound for visual mapping; ideal for locked-down envs.