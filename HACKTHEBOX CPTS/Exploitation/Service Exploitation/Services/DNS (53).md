# Enumerate DNS

```bash
nmap -p53 -Pn -sV -sC 10.10.110.213
```

---

# DNS Zone Transfer

## DIG - AXFR Zone Transfer

```bash
dig AXFR @ns1.inlanefreight.htb inlanefreight.htb
```

## Fierce - DNS Enumeration

```bash
fierce --domain zonetransfer.me
```

---

# Domain Takeovers & Subdomain Enumeration

### Domain Takeover

- Attackers **register expired domain names** to gain control.
- Used for:
    - Hosting **malicious websites**
    - Sending **phishing emails** from legitimate-looking domains.

---

### Subdomain Takeover

- Involves hijacking subdomains through **misconfigured DNS CNAME records**.
    
- Often occurs when organizations use third-party services like:
    
    - **AWS, GitHub, Akamai, Fastly,** etc.
- CNAME Record Example:
    
    ```
    sub.target.com.   60   IN   CNAME   anotherdomain.com
    ```
    
- If `anotherdomain.com` **expires and is registered by an attacker**, they can:
    
    - Control `sub.target.com`
    - Host content
    - Launch phishing or impersonation attacks

---

# Subdomain Enumeration

- **Goal:** Identify potential subdomains for takeover
- Tools: Subfinder, Sublist3r

### Sublist3r – DNS Brute-force Enumeration

- Uses a **wordlist** to guess subdomains

```bash

sublist3r -d target.com -w wordlist.txt
```

### Subfinder

```bash
z3tssu@htb[/htb]# ./subfinder -d inlanefreight.com -v       
                                                                       
        _     __ _         _                                           
____  _| |__ / _(_)_ _  __| |___ _ _          
(_-< || | '_ \\  _| | ' \\/ _  / -_) '_|                 
/__/\\_,_|_.__/_| |_|_||_\\__,_\\___|_| v2.4.5                                                                                                                                                                                                                                                 
                projectdiscovery.io                    
                                                                       
[WRN] Use with caution. You are responsible for your actions
[WRN] Developers assume no liability and are not responsible for any misuse or damage.
[WRN] By using subfinder, you also agree to the terms of the APIs used. 
                                   
[INF] Enumerating subdomains for inlanefreight.com
[alienvault] www.inlanefreight.com
[dnsdumpster] ns1.inlanefreight.com
[dnsdumpster] ns2.inlanefreight.com
...snip...
[bufferover] Source took 2.193235338s for enumeration
ns2.inlanefreight.com
www.inlanefreight.com
ns1.inlanefreight.com
support.inlanefreight.com
[INF] Found 4 subdomains for inlanefreight.com in 20 seconds 11 milliseconds
```

### Subrute

This tool allows us to use self-defined resolvers and perform pure DNS brute-forcing attacks during internal penetration tests on hosts that do not have Internet access.

```bash
z3tssu@htb[/htb]$ git clone <https://github.com/TheRook/subbrute.git> >> /dev/null 2>&1
z3tssu@htb[/htb]$ cd subbrute
z3tssu@htb[/htb]$ echo "ns1.inlanefreight.com" > ./resolvers.txt
z3tssu@htb[/htb]$ ./subbrute inlanefreight.com -s ./names.txt -r ./resolvers.txt

Warning: Fewer than 16 resolvers per process, consider adding more nameservers to resolvers.txt.
inlanefreight.com
ns2.inlanefreight.com
www.inlanefreight.com
ms1.inlanefreight.com
support.inlanefreight.com

<SNIP>
```

- Found 4 subdomains associated with [inlanefreight.com](http://inlanefreight.com)

### Enumerate CNAME with nslookup or host

```bash
z3tssu@htb[/htb]# host support.inlanefreight.com

support.inlanefreight.com is an alias for inlanefreight.s3.amazonaws.com
```

- Visiting the identified DNS
    
    ![image.png](attachment:7898d9eb-c3e8-4f19-af3d-5c8d3263b1a3:image.png)
    
    The support subdomain has an alias record pointing to an AWS S3 bucket. However, the URL [](https://support.inlanefreight.com/)[https://support.inlanefreight.com](https://support.inlanefreight.com) shows a NoSuchBucket error indicating that the subdomain is potentially vulnerable to a subdomain takeover. Now, we can take over the subdomain by creating an AWS S3 bucket with the same subdomain name.
    

---

### can-i-take-over-xyz

[https://github.com/EdOverflow/can-i-take-over-xyz](https://github.com/EdOverflow/can-i-take-over-xyz)

- It shows whether the target services are vulnerable to a subdomain takeover and provides guidelines on assessing the vulnerability.

---

# DNS Spoofing

- Explanation
    
    ---
    
    ### DNS Spoofing (DNS Cache Poisoning)
    
    - Alters legitimate DNS records with **false IP addresses**
    - Redirects users to **fraudulent or malicious websites**
    - Used in phishing, malware distribution, and surveillance
    
    ---
    
    ### Common Attack Paths
    
    1. **Man-in-the-Middle (MITM) Attack**
        - Attacker intercepts DNS requests/responses
        - Redirects users to a malicious IP instead of the intended one
    2. **Exploiting DNS Server Vulnerabilities**
        - Attacker gains access to a vulnerable DNS server
        - Modifies DNS records directly to serve malicious content
    
    ---
    

---

### Local DNS Cache Poisoning (MITM)

- Attack targets **local network** users by poisoning their DNS cache
- Redirects victims to a **malicious IP** for a specific domain
- Tools used: **Ettercap**, **Bettercap**

---

### Step 1: Edit DNS Mapping File

```bash
cat /etc/ettercap/etter.dns
```

```
inlanefreight.com      A   192.168.225.110
*.inlanefreight.com    A   192.168.225.110
```

---

### Step 2: Scan and Set Targets in Ettercap

1. Start Ettercap

- Navigate to: **Hosts > Scan for Hosts**
- Set victim IP (e.g., `192.168.152.129`) as **Target 1**
- Set gateway IP (e.g., `192.168.152.2`) as **Target 2**

![image.png](attachment:a5caa38e-72af-490a-b638-1edd30780e37:image.png)

---

### Step 3: Activate DNS Spoofing Plugin

- Go to: **Plugins > Manage Plugins**
- Enable: `dns_spoof` plugin

![image.png](attachment:0e4677da-1684-4aa3-9abb-419927d3f67a:image.png)

---

### Step 4: DNS Redirection Result

- Victim visiting `http://inlanefreight.com` is redirected to `192.168.225.110`
- Example (from victim’s machine):

![image.png](attachment:db6fba3a-7ebd-40a9-ad6c-4a849bd68062:image.png)

---

### Ping Confirmation of DNS Spoofing

```bash
C:\\>ping inlanefreight.com

Pinging inlanefreight.com [192.168.225.110] with 32 bytes of data:
Reply from 192.168.225.110: bytes=32 time<1ms TTL=64
Reply from 192.168.225.110: bytes=32 time<1ms TTL=64
Reply from 192.168.225.110: bytes=32 time<1ms TTL=64
Reply from 192.168.225.110: bytes=32 time<1ms TTL=64

Ping statistics for 192.168.225.110:
    Packets: Sent = 4, Received = 4, Lost = 0 (0% loss),
Approximate round trip times in milli-seconds:
    Minimum = 0ms, Maximum = 0ms, Average = 0ms
```